{% extends "base.html" %}

{% block title %}Adjacency Matrix | Discrete Math Calculator{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/handsontable@13.0.0/dist/handsontable.full.min.css">
<style>
    body { background: var(--surface-50, #f7f8fa); }
    .matrix-card { background: var(--surface-0, #fff); border-radius: 16px; box-shadow: 0 2px 12px rgba(99,102,241,0.07); padding: 1.5rem 1.5rem 1.2rem 1.5rem; margin-bottom: 2rem; border: 1.5px solid var(--surface-100, #e0e7ff); }
    .matrix-section-title { font-size: 1.15rem; font-weight: 600; color: var(--primary, #6366f1); margin-bottom: 1rem; }
    .matrix-controls .btn, .matrix-controls .form-check { margin-right: 0.5rem; margin-bottom: 0.5rem; }
    .matrix-controls .form-switch { margin-bottom: 0.5rem; }
    .matrix-controls { display: flex; flex-wrap: wrap; align-items: center; gap: 0.7rem; }
    .matrix-controls label { font-weight: 500; color: var(--primary, #6366f1); margin-right: 0.5rem; }
    .matrix-controls input[type=range] { width: 120px; margin: 0 0.5rem; }
    .matrix-panel { margin-bottom: 2rem; }
    .matrix-latex-panel, .matrix-analysis-panel, .matrix-graph-panel { background: var(--surface-100, #f1f5ff); border-radius: 14px; padding: 1.2rem 1.5rem; margin-bottom: 2rem; }
    .matrix-latex { font-size: 1.1rem; text-align: center; min-height: 2.5em; }
    .matrix-graph { min-width: 320px; min-height: 220px; }
    .matrix-footer { margin-top: 2.5rem; text-align: center; color: var(--gray-500, #6b7280); font-size: 1.05rem; opacity: 0.85; }
    .matrix-title { font-size: 2.1rem; font-weight: 700; color: var(--primary, #6366f1); margin-bottom: 0.2rem; text-align: center; }
    .matrix-subtitle { font-size: 1.1rem; color: var(--gray-500, #6b7280); text-align: center; margin-bottom: 1.5rem; }
    @media (max-width: 900px) {
        .matrix-card, .matrix-latex-panel, .matrix-analysis-panel, .matrix-graph-panel { padding: 1rem; border-radius: 10px; }
    }
    @media (max-width: 700px) {
        .matrix-title { font-size: 1.4rem; }
        .matrix-section-title { font-size: 1rem; }
    }
</style>
{% endblock %}

{% block extra_js %}
<script>
    window.MathJax = {
        tex: {inlineMath: [["\\(","\\)"]], displayMath: [["\\[","\\]"]]},
        svg: {fontCache: 'global'}
    };
</script>
<script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js" id="MathJax-script"></script>
<script src="https://cdn.jsdelivr.net/npm/handsontable@13.0.0/dist/handsontable.full.min.js"></script>
<script src="https://d3js.org/d3.v7.min.js"></script>
<script src="{{ url_for('static', filename='js/adjacency_matrix.js') }}"></script>
{% endblock %}

{% block content %}
<div class="container py-4">
    <div class="matrix-title">Adjacency Matrix Calculator</div>
    <div class="matrix-subtitle">Edit, analyze, and visualize graphs using adjacency matrices</div>
    <div class="alert alert-info mb-4" role="alert" style="font-size:1.05rem;">
        <b>How to use:</b> Use the controls to adjust matrix size, import/export, analyze, and visualize. Click a node to edit its label or color. All features are available in the cards below.
    </div>
    <div class="row g-4">
        <div class="col-lg-4 col-md-5">
            <div class="matrix-card">
                <div class="matrix-section-title"><i class="fas fa-cogs"></i> Matrix Controls</div>
                <div class="matrix-controls mb-2">
                    <label for="matrixSizeSlider">Size (n): <span id="matrixSizeValue">7</span></label>
                    <input type="range" min="1" max="20" value="7" id="matrixSizeSlider" aria-label="Matrix size slider">
                    <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" id="directedToggle" aria-label="Directed graph toggle">
                        <label class="form-check-label" for="directedToggle">Directed</label>
                    </div>
                    <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" id="weightedToggle" aria-label="Weighted graph toggle">
                        <label class="form-check-label" for="weightedToggle">Weighted</label>
                    </div>
                    <button id="addRowBtn" class="btn btn-outline-primary btn-sm" title="Add Row/Col" aria-label="Add Row/Col"><i class="fas fa-plus"></i> <span class="d-none d-md-inline">Add</span></button>
                    <button id="removeRowBtn" class="btn btn-outline-danger btn-sm" title="Remove Row/Col" aria-label="Remove Row/Col"><i class="fas fa-minus"></i> <span class="d-none d-md-inline">Remove</span></button>
                    <button id="importMatrixBtn" class="btn btn-outline-secondary btn-sm" title="Import Matrix" aria-label="Import Matrix"><i class="fas fa-file-import"></i> <span class="d-none d-md-inline">Import</span></button>
                    <button id="exportMatrixBtn" class="btn btn-outline-secondary btn-sm" title="Export Matrix" aria-label="Export Matrix"><i class="fas fa-file-export"></i> <span class="d-none d-md-inline">Export</span></button>
                    <button id="ocrMatrixBtn" class="btn btn-outline-success btn-sm" title="Import from Image (OCR)" aria-label="Import from Image (OCR)"><i class="fas fa-image"></i> <span class="d-none d-md-inline">OCR</span></button>
                    <button id="refreshMatrixBtn" class="btn btn-outline-secondary btn-sm" title="Reset matrix to all zeros" aria-label="Reset matrix to all zeros"><i class="fas fa-sync"></i> <span class="d-none d-md-inline">Reset</span></button>
                    <button id="matrixShortcutsHelp" class="btn btn-outline-info btn-sm" title="Show keyboard shortcuts" aria-label="Show keyboard shortcuts"><i class="fas fa-keyboard"></i> <span class="d-none d-md-inline">Shortcuts</span></button>
                    <button id="exampleMatrixBtn" class="btn btn-outline-warning btn-sm" title="Load Example" aria-label="Load Example"><i class="fas fa-lightbulb"></i> <span class="d-none d-md-inline">Example</span></button>
                    <button id="runBatchAnalysisBtn" class="btn btn-outline-primary btn-sm" title="Batch Analysis" aria-label="Batch Analysis"><i class="fas fa-table"></i> <span class="d-none d-md-inline">Batch</span></button>
                    <button id="exportAdjListBtn" class="btn btn-outline-info btn-sm" title="Export as Adjacency List (JSON)" aria-label="Export as Adjacency List (JSON)"><i class="fas fa-list"></i> <span class="d-none d-md-inline">Adj List</span></button>
                    <button id="exportEdgeListBtn" class="btn btn-outline-info btn-sm" title="Export as Edge List (CSV)" aria-label="Export as Edge List (CSV)"><i class="fas fa-project-diagram"></i> <span class="d-none d-md-inline">Edge List</span></button>
                    <button id="validateMatrixBtn" class="btn btn-outline-info btn-sm" title="Validate Matrix (squareness, symmetry)" aria-label="Validate Matrix (squareness, symmetry)"><i class="fas fa-check-circle"></i> <span class="d-none d-md-inline">Validate</span></button>
                </div>
            </div>
            <div class="matrix-card matrix-analysis-panel matrix-panel" aria-label="Matrix Analysis">
                <div class="matrix-section-title"><i class="fas fa-chart-bar"></i> Matrix Analysis</div>
                <div class="d-flex align-items-center gap-3 mb-2">
                    <label for="matrixPowerSlider" class="form-label mb-0">Matrix Power (p): <span id="matrixPowerValue">1</span></label>
                    <input type="range" min="1" max="10" value="1" id="matrixPowerSlider" class="form-range" style="max-width:200px;">
                </div>
                <div id="matrixPowerResult" class="mb-3"></div>
                <div id="matrixAnalysis"></div>
                <div id="batchAnalysisPanel"></div>
            </div>
        </div>
        <div class="col-lg-8 col-md-7">
            <div class="matrix-card matrix-panel" aria-label="Matrix Editor">
                <div class="matrix-section-title"><i class="fas fa-th"></i> Matrix Editor</div>
                <div id="adjMatrixHot"></div>
            </div>
            <div class="matrix-latex-panel matrix-panel" aria-label="LaTeX Preview">
                <div class="matrix-section-title"><i class="fas fa-superscript"></i> LaTeX Preview</div>
                <div class="matrix-latex" id="adjMatrixLatex"></div>
                <div class="alert alert-info mt-2" style="font-size:1.05rem;">
                    <b>LaTeX Help:</b> Write math using <code>\( ... \)</code> for inline and <code>\[ ... \]</code> for display. Example matrix:<br>
                    <code>\begin{pmatrix} 0 & 1 \\ 1 & 0 \end{pmatrix}</code>
                    <button id="copyLatexBtn" class="btn btn-outline-secondary btn-sm ms-2" title="Copy LaTeX to clipboard" aria-label="Copy LaTeX"><i class="fas fa-copy"></i></button>
                </div>
            </div>
            <div class="matrix-graph-panel matrix-panel" aria-label="Graph Visualization">
                <div class="matrix-section-title"><i class="fas fa-project-diagram"></i> Graph Visualization</div>
                <div class="d-flex justify-content-between align-items-center mb-2">
                    <span class="fw-bold">Graph</span>
                    <div class="btn-group">
                        <button id="exportGraphSvgBtn" class="btn btn-outline-secondary btn-sm" aria-label="Export Graph as SVG">SVG</button>
                        <button id="exportGraphPngBtn" class="btn btn-outline-secondary btn-sm" aria-label="Export Graph as PNG">PNG</button>
                    </div>
                </div>
                <div class="matrix-graph" id="adjGraphContainer"></div>
            </div>
        </div>
    </div>
    <footer class="matrix-footer mt-5">
        <span>Created by <a href="https://github.com/dataeclipse" target="_blank" rel="noopener">@dataeclipse</a></span>
        <span class="mx-2">|</span>
        <a href="https://github.com/dataeclipse/discrete_math_calculator" target="_blank" rel="noopener">GitHub Repo</a>
    </footer>
</div>
{% endblock %} 